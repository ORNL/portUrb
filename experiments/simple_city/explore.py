import matplotlib.pyplot as plt
import numpy as np

ref_u = [3                    ,\
         3.549532370424899    ,\
         4.067900770958515    ,\
         4.553906848103765    ,\
         5.006427062922798    ,\
         5.424415288411413    ,\
         5.806905227914102    ,\
         6.153012648988982    ,\
         6.461937427558303    ,\
         6.732965397618989    ,\
         6.965470002237022    ,\
         7.158913742008995    ,\
         7.312849417642273    ,\
         7.426921163781191    ,\
         7.500865271689334    ,\
         7.534510798886009    ,\
         7.541241633444431    ,\
         7.588333269551883    ,\
         7.675676841724368    ,\
         7.803070430872968    ,\
         7.970219531096269    ,\
         8.17673773051311     ,\
         8.422147604561678    ,\
         8.705881819699881    ,\
         9.027284444955459    ,\
         9.38561246829382     ,\
         9.780037514298128    ,\
         10.20964775919068    ,\
         10.65845808778699    ,\
         10.67345003876854    ,\
         11.17037214438025    ,\
         11.69926530163598    ,\
         12.2589068261207     ,\
         12.84800294997107    ,\
         13.46519181278163    ,\
         14.10904660992588    ,\
         14.77807889101415    ,\
         15.47074200086285    ,\
         16.18543465502034    ,\
         16.92050464158374    ,\
         17.67425264074866    ,\
         18.44493615326207    ,\
         19.23077352869659    ,\
         20.02994808423354    ,\
         20.8406123044333     ,\
         21.66089211228376    ,\
         22.48889120165342    ,\
         23.32269542113314    ,\
         24.16037719913241    ,\
         25                   ]

ref_T = [0.2026863948581893    ,\
         0.275741953692357     ,\
         0.3608295102073771    ,\
         0.4542847513803899    ,\
         0.5509203082288988    ,\
         0.6482936876064505    ,\
         0.7434530897268701    ,\
         0.8340881999619952    ,\
         0.9186163706008552    ,\
         0.9955599305795192    ,\
         1.063523903743288     ,\
         1.112524275705934     ,\
         1.160883125816965     ,\
         1.197382385057056     ,\
         1.221343897328362     ,\
         1.232325276060821     ,\
         1.234528015612423     ,\
         1.249994291120168     ,\
         1.278935377650586     ,\
         1.321740783578319     ,\
         1.378973132055477     ,\
         1.451360746179694     ,\
         1.539788011508129     ,\
         1.645283611704051     ,\
         1.769006754341225     ,\
         1.912231524029276     ,\
         2.076329518870589     ,\
         2.262750943638665     ,\
         2.445421084628125     ,\
         2.374099427497911     ,\
         1.957107694352226     ,\
         1.769407033784319     ,\
         1.630903261912906     ,\
         1.518563786197306     ,\
         1.423414059823272     ,\
         1.340861609920521     ,\
         1.268112604516652     ,\
         1.203365204944087     ,\
         1.145331243947362     ,\
         1.093051025227557     ,\
         1.045780349932182     ,\
         1.002922817906267     ,\
         0.963988513596771     ,\
         0.9285661242393135    ,\
         0.8963029649271167    ,\
         0.8668866205005666    ,\
         0.8400688299050065    ,\
         0.8155922278896944    ,\
         0.7932519864383959    ,\
         0.7728594389345915    ]

ref_C_T = [0.8074217298196819     ,\
           0.7846552966193032     ,\
           0.7817712451656341     ,\
           0.7853770722602772     ,\
           0.7880455836618256     ,\
           0.78992211898824       ,\
           0.7904646248467939     ,\
           0.7898683391170583     ,\
           0.7887275823106451     ,\
           0.7873593484701801     ,\
           0.7858954017448184     ,\
           0.7782758986778963     ,\
           0.7782758986778963     ,\
           0.7782758986778964     ,\
           0.7782758986778963     ,\
           0.7782758986778965     ,\
           0.7782758986778966     ,\
           0.7782758986778965     ,\
           0.7782758986778967     ,\
           0.7782758986778965     ,\
           0.7782758986778965     ,\
           0.7782758986778964     ,\
           0.7782758986778963     ,\
           0.7782758986778965     ,\
           0.7782758986778965     ,\
           0.7782758986778966     ,\
           0.7782758986778961     ,\
           0.7782758986778963     ,\
           0.7717617201567442     ,\
           0.7471496628674255     ,\
           0.562338457087221      ,\
           0.4634777767185589     ,\
           0.3890837182854031     ,\
           0.3298223852828678     ,\
           0.2814650705736599     ,\
           0.2414943447247149     ,\
           0.2081805744476891     ,\
           0.1802575679139672     ,\
           0.1567475347946594     ,\
           0.136877529405041      ,\
           0.1200263790712818     ,\
           0.1056894272351682     ,\
           0.09345374224322343    ,\
           0.08297963747032915    ,\
           0.07398645664181575    ,\
           0.066241165664466      ,\
           0.05955210657776765    ,\
           0.05375686601415353    ,\
           0.04872166173895309    ,\
           0.04433419657798143    ]

ref_C_P = [0.05674415527967022    ,\
           0.2345624204382323     ,\
           0.3238075519031745     ,\
           0.372458740900724      ,\
           0.4005684526985693     ,\
           0.4175053459790458     ,\
           0.4280060118650778     ,\
           0.4346448887011063     ,\
           0.4388813861189991     ,\
           0.4415922763346573     ,\
           0.4433041384021089     ,\
           0.4443448719345495     ,\
           0.4451212618086108     ,\
           0.4455955230356738     ,\
           0.4458775168485093     ,\
           0.4459945440740825     ,\
           0.4460179355372786     ,\
           0.4461807429723562     ,\
           0.4464505274094012     ,\
           0.4468023040162226     ,\
           0.4471866174905632     ,\
           0.4475556808465677     ,\
           0.4478724016336619     ,\
           0.447631643002248      ,\
           0.4468070388588149     ,\
           0.4460090749591742     ,\
           0.4452455952558135     ,\
           0.4445045507581403     ,\
           0.4441467212444436     ,\
           0.4422778365136124     ,\
           0.3858387454997234     ,\
           0.3358413024576732     ,\
           0.2919136406154312     ,\
           0.2535728336085945     ,\
           0.2202776524632924     ,\
           0.1914780249369672     ,\
           0.1666315253233102     ,\
           0.1452369809583038     ,\
           0.1268344544247661     ,\
           0.1110120699574339     ,\
           0.09740624431686562    ,\
           0.08569951749425664    ,\
           0.07561700722340149    ,\
           0.06692219854524818    ,\
           0.05941255086806066    ,\
           0.05291476415498288    ,\
           0.0472830504453918     ,\
           0.04239097813435144    ,\
           0.03813279101057084    ,\
           0.03441832861446217    ]

ref_P =   [0.042733312114890    ,\
           0.292585980850947    ,\
           0.607966543011364    ,\
           0.981097692589017    ,\
           1.401980840467542    ,\
           1.858670860023642    ,\
           2.337575996731491    ,\
           2.82409730163349     ,\
           3.303064559897411    ,\
           3.759432328418617    ,\
           4.178637713950588    ,\
           4.547191209664558    ,\
           4.855342681559048    ,\
           5.091537138796257    ,\
           5.248453137181144    ,\
           5.320793206669836    ,\
           5.335345498192627    ,\
           5.437905630135733    ,\
           5.631253024731564    ,\
           5.920980625996886    ,\
           6.315115601532293    ,\
           6.824470067101415    ,\
           7.462846389109999    ,\
           8.238359448488332    ,\
           9.167967030044268    ,\
           10.28521099696377    ,\
           11.61723699301185    ,\
           13.19441511499806    ,\
           15                   ,\
           15.00000129339826    ,\
           14.99997096069186    ,\
           15.00000933571983    ,\
           15.0000006288972     ,\
           15.00000010600892    ,\
           14.99994711657921    ,\
           15.0000808219012     ,\
           15.00005208840668    ,\
           15.00003591663907    ,\
           15.0000256172453     ,\
           15.00001834833055    ,\
           15.00001280805007    ,\
           15.00000835430353    ,\
           15.00000488465323    ,\
           15.00000232565897    ,\
           15.00000065886813    ,\
           14.99987147636662    ,\
           15.00000046953901    ,\
           15.0000019387927     ,\
           15.00000416561681    ,\
           15.00000687688721    ]

ref_rot = [4.999999999999999    ,\
           4.999999999999999    ,\
           4.999999999999999    ,\
           4.999999999999999    ,\
           4.999999999999999    ,\
           4.999999999999999    ,\
           4.999999999999999    ,\
           4.999999999999999    ,\
           4.999999999999999    ,\
           4.999999999999999    ,\
           4.999999999999999    ,\
           5.086085135839695    ,\
           5.195449486344377    ,\
           5.27649231398063     ,\
           5.329026265592259    ,\
           5.352929894261275    ,\
           5.357711848456155    ,\
           5.391168330690745    ,\
           5.453221996951704    ,\
           5.543729392838855    ,\
           5.662481285200129    ,\
           5.809203145832524    ,\
           5.983555786130776    ,\
           6.185136141216685    ,\
           6.413478201736261    ,\
           6.668054091170656    ,\
           6.948275286170338    ,\
           7.253493977091357    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ,\
           7.499245855779132    ]

def comp_C_T(uinf) :
  return np.interp(uinf,ref_u,ref_C_T,left=0.,right=0.)

def comp_T(uinf) :
  return np.interp(uinf,ref_u,ref_T,left=0.,right=0.)

def comp_C_P(uinf) :
  return np.interp(uinf,ref_u,ref_C_P,left=0.,right=0.)

def comp_P(uinf) :
  return np.interp(uinf,ref_u,ref_P,left=0.,right=0.)

def comp_rot(uinf) :
  return np.interp(uinf,ref_u,ref_rot,left=0.,right=0.)

def comp_a(uinf) :
  return 0.5*(1-np.sqrt(1-comp_C_T(uinf)))


u = np.arange(0.1,30,0.01)
a = comp_a(u)
for i in range(100) :
  a = comp_a(u/(1-a))

ui = u/(1-a)

plt.plot(u,u ,label="reference")
plt.plot(u,ui,label="freestream")
plt.xlabel("disk-integrated normal velocity magnitude")
plt.ylabel("free stream velocity magnitude")
plt.legend()
plt.show()
plt.close()

plt.plot(u,a)
plt.xlabel("disk-integrated normal velocity magnitude")
plt.ylabel("axial induction factor")
plt.show()
plt.close()

plt.plot(u,1/(1-a))
plt.xlabel("disk-integrated normal velocity magnitude")
plt.ylabel("freestream magnitude / disk-integrated magnitude")
plt.show()
plt.close()

plt.plot(u,comp_C_T(ui))
plt.xlabel("disk-integrated normal velocity magnitude")
plt.ylabel("coefficient of thrust")
plt.show()
plt.close()

plt.plot(u,comp_T(ui),label="Direct lookup")
plt.plot(u,0.5*1.2*comp_C_T(ui)*ui*ui*np.pi*242.23775645/2*242.23775645/2/1000/1000,label="From C_T")
plt.xlabel("disk-integrated normal velocity magnitude")
plt.ylabel("Total Thrust (MN)")
plt.legend()
plt.show()
plt.close()

plt.plot(u,comp_C_P(ui))
plt.xlabel("disk-integrated normal velocity magnitude")
plt.ylabel("coefficient of power")
plt.show()
plt.close()

plt.plot(u,comp_P(ui))
plt.xlabel("disk-integrated normal velocity magnitude")
plt.ylabel("total power (MW)")
plt.show()
plt.close()

plt.plot(u,comp_rot(ui))
plt.xlabel("disk-integrated normal velocity magnitude")
plt.ylabel("rotation rate (rpm)")
plt.show()
plt.close()



u = np.random.normal(loc=10,scale=1.38,size=100000)
a = comp_a(u)
for i in range(100) :
  a = comp_a(u/(1-a))
ui = u/(1-a)
fig, axs = plt.subplots(2,sharex=True)
axs[0].hist(u ,bins=np.arange(6,20,0.1),density=True)
axs[1].hist(ui,bins=np.arange(6,20,0.1),density=True)
axs[0].set_title("disk-integrated")
axs[1].set_title("freestream")
axs[1].set_xlabel("Wind Magnitude (m/s) Bins")
axs[0].set_ylabel("Probability Density")
axs[1].set_ylabel("Probability Density")
axs[0].set_ylim((0,0.6))
axs[1].set_ylim((0,0.6))
plt.show()
plt.close()

u = np.random.normal(loc=12,scale=1.38,size=100000)
a = comp_a(u)
for i in range(100) :
  a = comp_a(u/(1-a))
ui = u/(1-a)
fig, axs = plt.subplots(2,sharex=True)
axs[0].hist(u ,bins=np.arange(6,20,0.1),density=True)
axs[1].hist(ui,bins=np.arange(6,20,0.1),density=True)
axs[0].set_title("disk-integrated")
axs[1].set_title("freestream")
axs[1].set_xlabel("Wind Magnitude (m/s) Bins")
axs[0].set_ylabel("Probability Density")
axs[1].set_ylabel("Probability Density")
axs[0].set_ylim((0,0.6))
axs[1].set_ylim((0,0.6))
plt.show()
plt.close()



u = np.random.uniform(low=1,high=27,size=1000000)
a = comp_a(u)
for i in range(100) :
  a = comp_a(u/(1-a))
ui = u/(1-a)
fig, axs = plt.subplots(2,sharex=True)
axs[0].hist(u ,bins=np.arange(1,30,0.1),density=True)
axs[1].hist(ui,bins=np.arange(1,30,0.1),density=True)
axs[0].set_title("disk-integrated")
axs[1].set_title("freestream")
axs[1].set_xlabel("Wind Magnitude (m/s) Bins")
axs[0].set_ylabel("Probability Density")
axs[1].set_ylabel("Probability Density")
axs[0].set_ylim((0,0.1))
axs[1].set_ylim((0,0.1))
plt.show()
plt.close()
