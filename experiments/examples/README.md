# Example experiments

This is a directory you can clone into your own repo to design and maintain your own experiments using portUrb while keeping your repository separate from portUrb.
* `custom_modules`: You can create your own modules for your own experiments here. Right now, only initialization and perturbation routines are added. All other modules are in the `portUrb/model/modules` directory for use by all expeirments. The `sc_init.h` file ensures physical constants are declared in the `Coupler` as `Option` entries, that the primary variables are declared as `DataManager` entries in the `Coupler`, establishes boundary conditions as `Option` entries, and initializes the main variables of the `Coupler` with synthetic initial data for idealized experiments such as turbulence-seeded Atmospheric Boundary Layer experiments potentially with immersed material (with roughness and temperature properties) or with different initial wind profiles. `sc_perturb.h` adds the necessary perturbations such as potential temperature random perturbations to create turbulence or temperature thermals to initiate convection.
* `inputs`: This directory contains any inputs you might need for your experiments, and the `portUrb/build/cmakescript.sh` file will symlink this directory into the `portUrb/build` directory for convenient access. Currently, this directory contains reference wind turbine look-up tables for turbine simulations, a sounding for supercell simulation that mirrors WRF quarter_ss idealizes supercell simulation, and an OBJ wavefront file to describe building layouts in part of Manhattan Island.
* `*.cpp`: These are all experiment source files that each become their own executable to launch with a batch scheduler with appropriate input files potentially. Each will set `Coupler` `Option` entries as needed as well as run the following routines:
   * `coupler.init`: Initializes the `Coupler` object's parallel MPI communicator, vertical levels, horizontal grid extents and number of cells (horizontal grid spacing is computed internally).
   * `sc_init`: Defined in the `custom_modules` directory, initializes physical constants as `Coupler` `Option` entries, allocates required variables as `DataManager` entries, and initializes those variables with data.
   * Initialize the module classes via their `init` functions.
   * `sc_perturb`: Defined in the `custom_modules` directory, perturbs the initial state as needed to produce the desired dynamics (seed turbulence, or initiate convective thermals, etc)
   * `coupler.overwrite_with_restart`: If it's a restart file, then overwrite the initial state with a restart state. All variables declared as output variables with `coupler.register_output_variable` will automatically also be overwritten by this coupler routine from restart files. You can also use `coupler.register_overwrite_with_restart_module` to create your own custom restart routines that will be called by this routine as well. All declared "tracers" (using the `coupler.add_tracer` routine) are overwritten by restart. The following variables are automatically overwritten by restart files and are automatically output to output files:
      * `density_dry`, `uvel`, `vvel`, `wvel`, `temperature`.
   * `coupler.write_output_file`: This is for initial output and for output files during the simulation as well. The previous variable list are automatically output to file. All tracers added with `coupler.add_tracer` and declared as output variables by `coupler.register_output_variable` are automatically output as well. You can also create custom output functions with `coupler.register_write_output_module` to create your own output functions that will be called by this routine as well.
   * Time loop the modules you wish to run on the `Coupler` object(s) each time step.
   * `coupler.inform_user` to inform the user of some aspects of the simulation during the time loop
